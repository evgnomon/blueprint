#!/bin/bash

export EDITOR=vi

SECRET_FILE="$HOME/.config/blueprint/secrets/secrets.yaml"

VAULT_FILE="vault"

if [ -n "${1:-}" ]; then
  SECRET_FILE="$HOME/.config/blueprint/secrets/$1.yaml"
  VAULT_FILE="$1.vault"
fi

if [ ! -f "$HOME/.config/blueprint/secrets/$VAULT_FILE.asc" ]; then
  echo "Vault file not found: $HOME/.config/blueprint/secrets/$VAULT_FILE.asc"
  exit 1
fi

if [ ! -f "$SECRET_FILE" ]; then
  echo "Secret file not found: $SECRET_FILE"
  exit 1
fi

ANSIBLE_VAULT_PASSWORD_FILE=<(vault -d "$VAULT_FILE") ansible-vault view "$SECRET_FILE" | yj
