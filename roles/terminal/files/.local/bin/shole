#!/usr/bin/env bash
shole() {
    local bin_name=""
    local flag_help=0
    local flag_shell="sh"
    local flag_path="$HOME/.local/bin"
    
    # Function to display help
    help() {
        echo "shole: create a new executable script with a shebang"
        echo "usage: shole [-h] [-s shell] [-p path] name"
        echo "  -h, --help        show this help message and exit"
        echo "  -s, --shell       shell/language to use: sh, bash, py, python, zig. Default is sh"
        echo "  -p, --path        directory to place the script. Default is ~/.local/bin"
        echo "  name              name of the script to create"
        return 0
    }
    
    # Parse arguments
    while [[ $# -gt 0 ]]; do
        case $1 in
            -h|--help)
                flag_help=1
                shift
                ;;
            -s|--shell)
                if [[ -z "$2" ]]; then
                    echo "shole: error: -s/--shell requires an argument" >&2
                    return 1
                fi
                flag_shell="$2"
                shift 2
                ;;
            -p|--path)
                if [[ -z "$2" ]]; then
                    echo "shole: error: -p/--path requires an argument" >&2
                    return 1
                fi
                flag_path="$2"
                shift 2
                ;;
            -*)
                echo "shole: error: unknown option: $1" >&2
                return 1
                ;;
            *)
                bin_name="$1"
                shift
                ;;
        esac
    done
    
    # Show help if requested
    if [[ $flag_help -eq 1 ]]; then
        help
        return 0
    fi
    
    # Check if file path was provided
    if [[ -z "$bin_name" ]]; then
        echo "shole: error: the following arguments are required: name"
        return 1
    fi
    local bin_path="$flag_path/$bin_name"
    
    # Set shell string based on flag
    local shell_str
    case "$flag_shell" in
        py|python)
            shell_str="#!/usr/bin/env python3"
            ;;
        sh|bash)
            shell_str="#!/usr/bin/env bash"
            ;;
        zig)
            shell_str='//usr/bin/env zig run "$0" -- "$@"; exit "$?"'
            ;;
        *)
            shell_str="#!/usr/bin/env bash"
            ;;
    esac
    
    # Create directory if it doesn't exist
    mkdir -p "$flag_path"
    
    # Create the file with shebang
    echo "${shell_str}" > "$bin_path"
    # Make the file executable
    chmod +x "$bin_path"
}
shole "$@"
