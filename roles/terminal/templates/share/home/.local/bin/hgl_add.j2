#!/bin/bash

# Copyright header to add
COPYRIGHT_HEADER="/*
Copyright (C) 2025- {{ profiles[default_user_profile].fullname if profiles is defined else '' }}. All rights reserved.
License: HGL General License <https://evgnomon.org/docs/hgl>
*/"

# Find all Go files
find . -name "*.go" -type f | while read -r file; do
    echo "Processing: $file"

    # Check if file already has a copyright header
    if head -n 5 "$file" | grep -q "Copyright (C) 2025- {{ profiles[default_user_profile].fullname if profiles is defined else '' }}"; then
        echo "  Already has copyright header, checking URL format..."
        # Check if it has the wrong URL format and fix it
        if head -n 5 "$file" | grep -q "http://evgnomon.org/docs/hgl"; then
            echo "  Updating URL format from http to https..."
            sed -i 's|http://evgnomon.org/docs/hgl|https://evgnomon.org/docs/hgl|g' "$file"
        else
            echo "  Copyright header is correct, skipping..."
        fi
    else
        echo "  Adding copyright header..."
        # Create temporary file with copyright header + original content
        {
            echo "$COPYRIGHT_HEADER"
            cat "$file"
        } > "${file}.tmp"
        mv "${file}.tmp" "$file"
    fi
done

echo "Copyright headers added to all Go files."
